/**
 * @name: trackpush
 * @author: aimtell
 * @description: implements push approval & tracker
 * @version: 3.9431
 */

"use strict";var _aimtellPushToken,_aimtellRanScript,_aimtellSubscriberID,_aimtellRefreshResult,_aimtellAPI="https://api.aimtell.com/prod",_aimtellSWInitiated=!1,_aimtellNewSubscriberID=!1,_aimtellVersion=3.9431,_aimtellDebugQueue=[],_aimtellDebugQueueActive=0,_aimtellPrompted=!1;void 0===_at.track&&(_aimtellVersion=3.933);var trackData,_aimtellTrackData,_aimtellPageLoadAttributes=JSON.parse(JSON.stringify(_at.attributes));if(void 0===_at.webpushid&&(_at.webpushid="web.aimtell.com"),_at.webpushid=_at.webpushid.replace("apple.com","aimtell.com"),void 0===_at.worker&&(_at.worker=window.location.origin+"/aimtell-worker.js?v="+_aimtellVersion+"&cb=011419"),"/wp-content/plugins/aimtell-web-push-notifications/assets/json/aimtell-manifest.json"==_at.manifest&&(_at.manifest="https://s3.amazonaws.com/cdn.aimtell.com/manifest/"+_at.idSite+".json"),!1!==_at.showCredit&&console.log("Push notifications powered by Aimtell. Learn more at https://aimtell.com/developers"),1==getUrlVars().aimtelldebug||!0===_at.debug){var _aimtellDebug=1;_aimtellDebugQueueProcess()}function _aimtellDeferred(){this._done=[],this._fail=[]}function getUrlVars(){var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,i){a[t]=i});return a}function _aimtellGetDeviceType(){var e,t=1,i="desktop";return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=2),2==t&&(i="mobile"),i}function _aimtellGetPageDetails(){return{pageTitle:document.title,pageURL:window.location.href}}function _aimtellLoadBeacon(){var e=document.createElement("iframe");e.setAttribute("src","https://beacon.aimtell.com/?id_site="+_at.idSite+"&subscriber_uid="+_at.subscriber),e.style.width="1px",e.style.height="1px",e.style.display="none",document.body.appendChild(e)}function _aimtellGetReferrer(){var e=null,t=null;return 0!==document.referrer.indexOf(location.protocol+"//"+location.host)&&(e=document.referrer?document.referrer:null,t=document.referrer?document.referrer.split("/")[2]:null),{refName:t,refUrl:e}}function _aimtellGetLanguage(){return navigator.language||navigator.userLanguage}function _aimtellGetResolution(){var e="";screen.width&&(e+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));return e}function _aimtellGetBrowserInfo(){navigator.appVersion;var e,t,i,a=navigator.userAgent,n=navigator.appName,o=""+parseFloat(navigator.appVersion),r=parseInt(navigator.appVersion,10);return-1!=(t=a.indexOf("Opera"))&&(n="Opera",o=a.substring(t+6),-1!=(t=a.indexOf("Version"))&&(o=a.substring(t+8))),-1!=(t=a.indexOf("OPR"))?(n="Opera",o=a.substring(t+4)):-1!=(t=a.indexOf("MSIE"))?(n="Microsoft Internet Explorer",o=a.substring(t+5)):-1!=(t=a.indexOf("Edge"))?(n="Edge",o=a.substring(t+5)):-1!=(t=a.indexOf("Chrome"))?(n="Chrome",o=a.substring(t+7)):-1!=(t=a.indexOf("Safari"))?(n="Safari",o=a.substring(t+7),-1!=(t=a.indexOf("Version"))&&(o=a.substring(t+8))):-1!=(t=a.indexOf("Firefox"))?(n="Firefox",o=a.substring(t+8)):-1!=a.indexOf("Trident/")?(n="Microsoft Internet Explorer",o=a.substring(a.indexOf("rv:")+3)):(e=a.lastIndexOf(" ")+1)<(t=a.lastIndexOf("/"))&&(n=a.substring(e,t),o=a.substring(t+1),n.toLowerCase()==n.toUpperCase()&&(n=navigator.appName)),-1!=(i=o.indexOf(";"))&&(o=o.substring(0,i)),-1!=(i=o.indexOf(" "))&&(o=o.substring(0,i)),-1!=(i=o.indexOf(")"))&&(o=o.substring(0,i)),r=parseInt(""+o,10),isNaN(r)&&(o=""+parseFloat(navigator.appVersion),r=parseInt(navigator.appVersion,10)),{browser:n,version:o,majorVersion:r}}function _aimtellGetSystemInfo(){var e=navigator.userAgent,t=navigator.appVersion,i="-",a=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var n in a){var o=a[n];if(o.r.test(e)){i=o.s;break}}var r="-";switch(/Windows/.test(i)&&(r=/Windows (.*)/.exec(i)[1],i="Windows"),i){case"Mac OS X":r=/Mac OS X (10[\.\_\d]+)/.exec(e)[1];break;case"Android":r=/Android ([\.\_\d]+)/.exec(e)[1];break;case"iOS":r=(r=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+r[2]+"."+(0|r[3])}return{os:i,osVersion:r}}function _aimtellDebugger(e,t){if(1==_aimtellDebug){var i={};switch(i.message=e,i.level=t||3,t){case 3:console.log("[aimtell]"+e);break;case 4:console.warn("[aimtell]"+e);break;case 5:console.error("[aimtell]"+e);break;default:console.log("[aimtell]"+e)}1==getUrlVars().aimtelldebug&&_aimtellDebugQueue.push(i)}}function _aimtellDebugQueueProcess(){0===_aimtellDebugQueueActive&&0<_aimtellDebugQueue.length?(_aimtellDebugQueueActive=1,_aimtellLogDebug(_aimtellDebugQueue[0].message,_aimtellDebugQueue[0].level).then(function(e){_aimtellDebugQueueActive=0,_aimtellDebugQueue.shift(),_aimtellDebugQueueProcess()})):setTimeout(function(){_aimtellDebugQueueProcess()},2e3)}function _aimtellLogDebug(n,o){return new Promise(function(t,e){var i;i=new XMLHttpRequest;var a="https://log.aimtell.com/debug?type=trackpush";a+="&website_id="+_at.idSite,a+="&body="+n,a+="&log_level="+o,i.onreadystatechange=function(){if(4==i.readyState){var e=JSON.parse(i.responseText);t(e)}},i.open("POST",a,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send()})}function _aimtellInitialize(){return _aimtellDebugger("Initializing."),_at.idSite?"denied"==_aimtellCheckPermissions()?(_aimtellDebugger("User has denied push"),_aimtellTrackData.optin.action=2,_aimtellTrack(_aimtellTrackData,["optin"]),!1):"granted"==_aimtellCheckPermissions()?(_aimtellDebugger("User has already granted permissions, updating visitor"),_aimtellGetPushToken().then(function(e){if(e||_aimtellLogError("Push granted but no token found"),_aimtellSWInitiated||_aimtellNewSubscriberID)_aimtellDebugger("Updating optin details because of condition. New SW Initiated:"+_aimtellSWInitiated+" New Subscriber ID: "+_aimtellNewSubscriberID),_aimtellTrackData.optin.push_token=e,_aimtellTrackData.optin.action=1,_aimtellTrack(_aimtellTrackData,["optin"]),_aimtellAmplifySubscriberWorkerData();else{var t={};t.id_site=_aimtellTrackData.id_site,t.subscriber_uid=_aimtellTrackData.subscriber_uid,t.optin={},t.optin.action=1,t.optin.push_token=e,_aimtellTrack(t,["optin"])}_aimtellTrack(_aimtellTrackData,["attribute","page"]),_aimtellGetCookie("_aimtellSessionChecks")||(_aimtellAmplifySubscriberWorkerData(),_aimtellSetCookie("_aimtellSessionChecks",!0,1),_aimtellValidateSubscriber())}),!1):_aimtellGetCookie("_aimtellPromptDenied")?(_aimtellDebugger("User has denied prompt"),!1):_aimtellGetCookie("_aimtellPromptApproved")?(_aimtellDebugger("User has approved prompt, but never opted into native"),!1):void _aimtellGetSiteConfig(_at.idSite).then(function(e){var t=_aimtellGetPageDetails().pageURL,i=0,a=0,n=null,o=null,r=null;t=t.replace(/(\/#|\/|#)$/,"");for(var l=_aimtellGetDeviceType(),s=0;s<e.length;s++)if(!e[s].device_type||e[s].device_type==l||"any"==e[s].device_type){var c=e[s].page;if(c=(c=(c=(c=(c=c.replace(/(\/#|\/|#)$/,"")).replace(/\*|\/\*/g,"[^ ]*")).replace(/\?/g,"\\?")).replace(/https/g,"[^ ]*")).replace(/http/g,"[^ ]*"),c+="$",t.match(c)){i=e[s].promptId,a=e[s].auto_prompt,n=e[s].seconds_delay||null,o=e[s].scroll_delay||null,r=e[s].pages_delay||null;break}}0<i?_aimtellLoadPrompt(i,a,n,o,r):1==a?_aimtellPrompt():o?_aimtellEnableScrollDelayPrompt(o):n?_aimtellEnableSecondsDelayPrompt(n):r&&_aimtellEnablePageDelayPrompt(r)}):(_aimtellDebugger("[aimtell] - idSite must be set.",4),!1)}function _aimtellEnablePageDelayPrompt(e){var t=e,i=_aimtellGetCookie("_aimtellSessionPageViews");t<=++i&&_aimtellPrompt(),_aimtellSetCookie("_aimtellSessionPageViews",i)}function _aimtellEnableScrollDelayPrompt(i){window.addEventListener("scroll",function(e){var t=_aimtellGetPercentageScrolled();i<=t&&!0!==_aimtellPrompted&&(_aimtellPrompt(),_aimtellPrompted=!0)})}function _aimtellEnableSecondsDelayPrompt(e){setTimeout(function(){!0!==_aimtellPrompted&&(_aimtellPrompt(),_aimtellPrompted=!0)},1e3*e)}function _aimtellValidateSubscriber(){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=JSON.parse(t.responseText);e&&!0===e.update_sw&&(_aimtellDebugger("Revalidating Subscriber."),_aimtellForceRefreshSW(0))}},t.open("GET","https://analytics.aimtell.com/subscriber?id_site="+_at.idSite+"&subscriber_uid="+_at.subscriber,!0),t.send(null)}function _aimtellGetSiteConfig(e){return new Promise(function(t,i){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(404==a.status)_aimtellLogError("Unable to get site configuration file"),i("[aimtell] - Unable to retrieve configuration file. See more: https://aimtell.com/jserror/getsiteconfig");else{var e=JSON.parse(a.responseText);t(e)}},a.open("GET","https://s3.amazonaws.com/cdn.aimtell.com/config/"+e+"-"+_at.owner+".json",!0),a.send(null)})}function _aimtellGetPercentageScrolled(){var e=window.innerHeight||(document.documentElement||document.body).clientHeight,t=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop,i=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-e;return Math.floor(t/i*100)}function _aimtellLoadPrompt(e,i,a,n,o){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState){var e=JSON.parse(r.responseText),t=document.createElement("DIV");t.setAttribute("id","aimtellPrompt"),t.innerHTML=e.code,document.body.appendChild(t),document.getElementById("aimtellPrompt").style.display="none",_at.prompt.custom_prompt_id=e.id,_aimtellTrackData.optin.prompt_id=e.id,1==i?(_aimtellDebugger("Custom prompt loaded, trigger prompt()."),_aimtellPrompt()):a?_aimtellEnableSecondsDelayPrompt(a):n?_aimtellEnableScrollDelayPrompt(n):o&&_aimtellEnablePageDelayPrompt(o)}},r.open("GET","https://s3.amazonaws.com/cdn.aimtell.com/prompts/"+e+".json?cb="+Math.floor(Date.now()/1e3),!0),r.send(null)}function _aimtellPromptApprove(){_aimtellDebugger("Custom prompt approved."),document.getElementById("aimtellPrompt").style.display="none",_aimtellSetCookie("_aimtellPromptApproved",!0,7),_aimtellRunNative()}function _aimtellPromptDeny(){_aimtellDebugger("Custom prompt denied."),_aimtellSetCookie("_aimtellPromptDenied",!0,14),_aimtellTrackData.optin.action=2,_aimtellTrack(_aimtellTrackData,["optin"]),document.getElementById("aimtellPrompt").style.display="none"}function _aimtellPromptCancel(){_aimtellDebugger("Custom prompt cancelled."),document.getElementById("aimtellPrompt").style.display="none"}function _aimtellGetSubscriberID(){return new Promise(function(i,e){var a=_aimtellGetCookie("_aimtellSubscriberID");a?i(a):"granted"==_aimtellCheckPermissions()?_aimtellGetPushToken().then(function(t){if(!t)return _aimtellDebugger("A Fatal Error Occured. Permission granted but no token found.",5),!1;_aimtellGetSubscriberIDFromToken(t).then(function(e){e.uid?a=e.uid:(a=_aimtellGenerateID(),_aimtellNewSubscriberID=!0,_at.attributes.push_token=t),_aimtellSetCookie("_aimtellSubscriberID",a,100),i(a)})}):(a=_aimtellGenerateID(),_aimtellNewSubscriberID=!0,_aimtellSetCookie("_aimtellSubscriberID",a,100),i(a))})}function _aimtellIsNewData(e,t){if(!t)return!1;var i=!0,a=_aimtellHashString(JSON.stringify(t));if("undefined"!=typeof Storage){var n="_aimtellTrackData["+e+"]";sessionStorage.getItem(n)==a?i=!1:sessionStorage.setItem(n,a)}return i}function _aimtellTrack(t,e){new XMLHttpRequest;var i={},a=0;i.id_site=t.id_site,i.subscriber_uid=t.subscriber_uid;var n,o=["attribute","optin","event","page","alias"];if(Array.isArray(e)&&(o=e),o.forEach(function(e){_aimtellIsNewData(e,t[e])&&(i[e]=t[e],a++)}),!a)return _aimtellDebugger("No New Track Data To Send"),!1;i=JSON.stringify(i),(n=new XMLHttpRequest).open("POST","https://analytics.aimtell.com/subscriber",!0),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(i),_aimtellDebugger("Track Data Sent ")}function _aimtellAppendManifestHeader(e){if(!document.querySelector('link[rel="manifest"]')){var t=document.createElement("link");t.rel="manifest",t.href=e,document.head.appendChild(t)}}function _aimtellGetManifestLocation(){return new Promise(function(t,e){if(void 0!==_at.manifest)_aimtellAppendManifestHeader(_at.manifest),t(_at.manifest);else{var i=new XMLHttpRequest,a="https://s3.amazonaws.com/cdn.aimtell.com/manifest/"+_at.idSite+".json";i.onreadystatechange=function(){if(4==i.readyState)if(404==i.status)_at.manifest=window.location.origin+"/aimtell-manifest.json",_aimtellAppendManifestHeader(_at.manifest),t(_at.manifest);else{var e=JSON.parse(i.responseText);_at.gcm_id=e.gcm_sender_id,_at.manifest=a,_aimtellAppendManifestHeader(_at.manifest),t(_at.manifest)}},i.open("GET",a,!0),i.send(null)}})}function _aimtellGetGCMID(){return new Promise(function(i,a){_at.gcm_id&&i(_at.gcm_id),_aimtellGetManifestLocation().then(function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState)if(404==t.status)_aimtellLogError("Missing manifest file"),a("[aimtell] - Missing Manifest file");else{var e=JSON.parse(t.responseText);i(e.gcm_sender_id)}},t.open("GET",e,!0),t.send(null)})})}function _aimtellLogError(e,t){if(void 0===t&&(t=0),_aimtellIsNewData("error",e)){var i;i=new XMLHttpRequest;var a="https://log.aimtell.com/error?type=trackpush";a+="&website_id="+_at.idSite,a+="&body="+e,a+="&log_level="+t,i.open("POST",a,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send()}}function _aimtellGetSubscriberIDFromToken(a){return new Promise(function(t,e){_aimtellDebugger("Update SubscriberID From Token Ran ");var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState){var e=JSON.parse(i.responseText);t(e)}},i.open("GET",_aimtellAPI+"/subscriber/token/"+a+"?id_site="+_at.idSite,!0),i.send(null)})}function _aimtellGetSubscriberAttributes(){return new Promise(function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState){var e=JSON.parse(i.responseText);t(e)}};var a=_aimtellAPI+"/subscriber/"+_at.subscriber+"/attributes";a+="?idSite="+_at.idSite,i.open("GET",a,!0),i.send(null)})}function _aimtellGenerateID(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function _aimtellGetCookie(e){for(var t=e+"=",i=document.cookie.split(";"),a=0;a<i.length;a++){for(var n=i[a];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}function _aimtellSetCookie(e,t,i){var a=new Date;a.setTime(a.getTime()+24*i*60*60*1e3);var n="expires="+a.toUTCString();document.cookie=e+"="+t+"; path=/ ;"+n}function _aimtellDeleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}function _aimtellHashString(e,t,i){var a,n,o=void 0===i?2166136261:i;for(a=0,n=e.length;a<n;a++)o^=e.charCodeAt(a),o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return t?("0000000"+(o>>>0).toString(16)).substr(-8):o>>>0}function _aimtellTrackAttributes(t){Object.keys(t).forEach(function(e){_aimtellTrackData.attribute[e]=t[e]}),_aimtellTrack(_aimtellTrackData,["attribute"])}function _aimtellForcePrompt(){if("granted"==_aimtellCheckPermissions()||"denied"==_aimtellCheckPermissions())return!1;var e=document.getElementById("aimtellPrompt");void 0!==e&&null!=e&&(_aimtellDebugger("Showing Custom Prompt "),document.getElementById("aimtellPrompt").style.display="block")}function _aimtellPrompt(){if("granted"==_aimtellCheckPermissions()||"denied"==_aimtellCheckPermissions)return!1;if(_aimtellGetCookie("_aimtellPromptDenied"))return _aimtellDebugger("User has denied prompt"),!1;var e=document.getElementById("aimtellPrompt");void 0!==e&&null!=e?(_aimtellDebugger("Showing Custom Prompt "),document.getElementById("aimtellPrompt").style.display="block"):(_aimtellDebugger("Loading Native Prompt "),_aimtellRunNative())}function _aimtellAlias(e){var t={};t.id_site=_aimtellTrackData.id_site,t.subscriber_uid=_aimtellTrackData.subscriber_uid,t.alias=e,_aimtellTrack(t,["alias"])}function _aimtellTrackEvent(e,t,i,a){if(0==_aimtellSupportsPush())return!1;_aimtellDebugger("Track Event Sent "),_aimtellTrackData.event.category=e,_aimtellTrackData.event.action=t,i&&(_aimtellTrackData.event.label=i),a&&(_aimtellTrackData.event.value=a),_aimtellTrack(_aimtellTrackData,["event"])}function _aimtellAbandonedCart(e,t){if(0==_aimtellSupportsPush())return!1;if(null==e)return!1;var i,a={};a.type=e,t&&(a.delay=t),a.idSite=_at.idSite,a.owner_uid=_at.owner,a=JSON.stringify(a),(i=new XMLHttpRequest).open("POST",_aimtellAPI+"/subscriber/"+_at.subscriber+"/cart",!0),i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),i.setRequestHeader("Aimtell-Track-Source","js"),i.send(a),_aimtellDebugger("Abandoned Cart Data Sent ")}function _aimtellTc(n,o,r){return new Promise(function(t,i){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(404==a.status)i("[aimtell] - Unable to track.");else{var e=JSON.parse(a.responseText);t(e)}};var e={};e.subscriber_uid=o,e.logid=n,e.redirect_url=r,e=JSON.stringify(e),a.open("POST",_aimtellAPI+"/push/click/"+n,!0),a.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),a.setRequestHeader("Aimtell-Track-Source","js"),a.send(e)})}_aimtellDeferred.prototype={execute:function(e,t){var i=e.length;for(t=Array.prototype.slice.call(t);i--;)e[i].apply(null,t)},resolve:function(){this.execute(this._done,arguments)},reject:function(){this.execute(this._fail,arguments)},done:function(e){this._done.push(e)},fail:function(e){this._fail.push(e)}};var webURL=getUrlVars().atlink;if(webURL){var logid=getUrlVars().logid,subscriber_uid=getUrlVars().subscriber_uid;_aimtellTc(logid,subscriber_uid,webURL).then(function(e){e&&"error"==e.result?console.warn("[aimtell] Invalid Redirect URL"):e&&"success"==e.result&&e.redirect_url&&(window.location=e.redirect_url)})}function _aimtellGetPushToken(){return new Promise(function(t,e){0==_aimtellSupportsPush()&&t(_aimtellPushToken=null),"safari"in window&&"pushNotification"in window.safari?(_aimtellPushToken=window.safari.pushNotification.permission(_at.webpushid).deviceToken,t(_aimtellPushToken)):"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.pushManager.getSubscription().then(function(e){e?(_aimtellPushToken=_aimtellExtractSubscriptionId(e.endpoint),t(_aimtellPushToken)):"granted"==_aimtellCheckPermissions()?navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){_aimtellPushToken=_aimtellExtractSubscriptionId(e.endpoint),_aimtellSWInitiated=!0,t(_aimtellPushToken)})}):t(_aimtellPushToken=null)})})})}function _aimtellSupportsPush(){var e=!1;return"safari"in window&&"pushNotification"in window.safari&&(e=!0),"Safari"==_aimtellGetBrowserInfo().browser&&window.top!==window&&(e=!0),"serviceWorker"in navigator&&"Safari"!=_aimtellGetBrowserInfo().browser&&(e=!0,"showNotification"in ServiceWorkerRegistration.prototype||(e=!1),"PushManager"in window||(e=!1),0==_aimtellCheckHTTPS()&&(e=!1)),"Promise"in window||(e=!1),e}function _aimtellCheckHTTPS(){var e=!1;return"https:"==window.location.protocol&&(e=!0),e}function _aimtellListener(e,t,i){e.addEventListener(t,i)}function _webpushCheckPermissions(){return _aimtellCheckPermissions()}function _webpushSupportsPush(){return _aimtellSupportsPush()}function _webpushPrompt(){_aimtellPrompt()}function _webpushRunNative(){_aimtellRunNative()}function _webpushGetSubscriberIDFromToken(i){return new Promise(function(t,e){aimtellGetSubscriberIDFromToken(i).then(function(e){t(e)})})}function _webpushTrackAttributes(e){_aimtellTrackAttributes(e)}function _webpushGetToken(){return new Promise(function(t,e){_aimtellGetPushToken().then(function(e){t(e)})})}function _webpushTrackEvent(e,t,i,a){_aimtellTrackEvent(e,t,i,a)}function _webpushGetSubscriberID(){return new Promise(function(t,e){_aimtellGetSubscriberID().then(function(e){t(e)})})}function _aimtellCheckPermissions(){return"safari"in window&&"pushNotification"in window.safari?window.safari.pushNotification.permission(_at.webpushid).permission:"Notification"in window&&"permission"in window.Notification?Notification.permission:void 0}function _aimtellRunNative(){if(0==_aimtellSupportsPush())return _aimtellDebugger("Browser doesn't support push"),!1;if("safari"in window&&"pushNotification"in window.safari){var e=window.safari.pushNotification.permission(_at.webpushid);return _aimtellDebugger(e),_aimtellSafariRun(e),!1}"serviceWorker"in navigator&&_aimtellChromeRun()}function _aimtellSafariRun(e){if("default"===e.permission){_aimtellDebugger("User Requested Permissions");var t=_at.domain,i=t.indexOf("/");t=t.substring(0,-1!=i?i:t.length),window.safari.pushNotification.requestPermission("https://api-lambda.aimtell.com/prod/safari-package/"+t,_at.webpushid,{},_aimtellSafariRun)}else if("denied"===e.permission)_aimtellDebugger("User Denied Permissions"),_aimtellTrackData.optin.action=2,_aimtellTrack(_aimtellTrackData,["optin"]),"undefined"!=typeof _aimtellPermissionDenied&&_aimtellPermissionDenied();else if("granted"===e.permission){var a=e.deviceToken;_aimtellTrackData.optin.action=1,_aimtellTrackData.optin.push_token=a,_aimtellTrack(_aimtellTrackData,["attribute","optin","page"]),_aimtellTrackAttributes({subscription_url:window.location.href}),_aimtellPermissionGrantedCallbacks()}}function _aimtellDelWidgetNotification(e){document.getElementById("webwidget-notification-"+e).remove();document.getElementById("notification-badge");_aimtellCheckNotificationRemaining()}function _aimtellDelAllWidgetNotification(){document.getElementById("webwidget-body").innerHTML="",_aimtellShowNoNotifications()}function _aimtellCheckNotificationRemaining(){var e=document.getElementsByClassName("webwidget-notification");document.getElementById("notification-badge-count").innerHTML=e.length,document.getElementById("notification-badge").style.opacity=1,0==e.length&&(_aimtellShowNoNotifications(),document.getElementById("notification-badge").style.opacity=0)}function _aimtellClickedNotification(e,t,i){_aimtellDelWidgetNotification(e),window.open(t)}function _aimtellShowNotificationCenter(){document.getElementById("notification-icon").className="transition-hide",document.getElementById("notification-icon-close").className="transition-show",document.getElementById("webwidget-content").className="show-widget-contents"}function _aimtellHideNotificationCenter(){document.getElementById("notification-icon").className="transition-show",document.getElementById("notification-icon-close").className="transition-hide",document.getElementById("webwidget-content").className="hide-widget-contents"}function _aimtellAppendNotification(e,t,i,a,n){var o='<div id="webwidget-notification-'+e+'" class="webwidget-notification">';o+='<div onClick="_aimtellDelWidgetNotification('+e+')" class="webwidget-notification-del">X</div>',o+='<div onClick="_aimtellClickedNotification('+e+",'"+n+'\', this)" class="webwidget-notification-img">',o+='<img src="'+a+'">',o+="</div>",o+='<div onClick="_aimtellClickedNotification('+e+",'"+n+'\', this)" class="webwidget-notification-text">',o+='<span class="webwidget-notification-title">'+t+"</span>",o+='<span class="webwidget-notification-body">'+i+"</span>",o+="</div>",o+="</div>",document.getElementById("webwidget-body").innerHTML+=o}function _aimtellShowNoNotifications(){document.getElementById("webwidget-body").innerHTML='<div id="webwidget-pushbell" ><img src="push_bell_large.png"><span id="webwidget-text">No new notifications, check back later!</span></div>',document.getElementById("notification-badge").style.opacity=0}function _aimtellShowNotSubscribed(){document.getElementById("webwidget-body").innerHTML='<div id="webwidget-pushbell" ><img src="push_bell_large.png"><span id="webwidget-text">You are not currently subscribed.</span><div onClick="_aimtellPrompt()" id="webwidget-subscribe"><span>Click to subscribe</span></div></div>'}function _aimtellLaunchNotificationCenter(){var e=document.createElement("style");e.innerHTML="#webwidget{width:70px;height:70px;position:fixed;bottom:25px;left:25px;border-radius:50%;background-color:#3cba5d;display:block;box-shadow:0 1px 6px rgba(0,0,0,.15),0 2px 32px rgba(0,0,0,.15)!important}#webwidget:hover{box-shadow:0 1px 6px rgba(0,0,0,.20),0 2px 32px rgba(0,0,0,.20)!important;cursor:pointer}#webwidget #notification-badge{display:block;position:absolute;right:0;top:0;background-color:#e95269;color:#FFF;border-radius:50%;width:25px;height:25px;opacity:0}#webwidget #notification-badge span{display:block;margin:0 auto;text-align:center;margin-top:2px}#webwidget #notification-icon,#webwidget #notification-icon-close{position:absolute;left:17px;top:17px}#webwidget #notification-icon{opacity:1;z-index:9}#webwidget #notification-icon-close{opacity:0}#webwidget .transition-show{opacity:1!important;z-index:9;-webkit-transition:opacity .2s ease-in-out;-moz-transition:opacity .2s ease-in-out;-o-transition:opacity .2s ease-in-out;transition:opacity .2s ease-in-out;-webkit-transition:.3s ease-in-out;-moz-transition:.3s ease-in-out;-o-transition:.3s ease-in-out;transition:.3s ease-in-out;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(0deg)}#webwidget .transition-hide{opacity:0!important;z-index:8;-webkit-transition:opacity .2s ease-in-out;-moz-transition:opacity .2s ease-in-out;-o-transition:opacity .2s ease-in-out;transition:opacity .2s ease-in-out;-webkit-transition:.3s ease-in-out;-moz-transition:.3s ease-in-out;-o-transition:.3s ease-in-out;transition:.3s ease-in-out;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}#webwidget #notification-icon-close{left:28px;top:20px;font-size:22px;color:#FFF}#webwidget-content{opacity:0;-webkit-transition:opacity .2s ease-in-out;-moz-transition:opacity .2s ease-in-out;-o-transition:opacity .2s ease-in-out;transition:opacity .2s ease-in-out;height:500px;width:350px;display:block;background-color:#FFF;position:absolute;top:-515px;left:25px;border-radius:10px}#webwidget-content.show-widget-contents{opacity:1!important}#webwidget-content.hide-widget-contents{opacity:0!important}#webwidget-content-header{background-color:#3cba5d;color:#FFF;padding:20px}#webwidget-content-header span{display:block;font-size:16px}#webwidget #webwidget-content #webwidget-pushbell img{display:block;margin:0 auto;margin-top:25px}#webwidget #webwidget-content #webwidget-pushbell{padding:20px}#webwidget #webwidget-content #webwidget-pushbell span{display:block;text-align:center;padding-top:15px}#webwidget #webwidget-content #webwidget-pushbell #webwidget-subscribe span{display:block;text-align:center;padding:10px;background:#428bca;border-radius:2px;margin:0 auto;color:#FFF;width:175px;cursor:pointer;margin-top:15px}#webwidget-footer{position:absolute;bottom:10px;margin:0 auto;display:block;border-top:1px solid #E9E9E9;padding-top:10px;width:100%}#webwidget-footer span,#webwidget-footer a{display:block;text-align:center;font-size:12px;color:#615d5d}.webwidget-notification{border-top:1px solid #f7f5f5;position:relative}.webwidget-notification-del{position:absolute;top:5px;right:5px;cursor:pointer;z-index:10;color:#f7f5f5}.webwidget-notification-del:hover{color:#e95269}.webwidget-notification:hover{background:#f7f5f5;cursor:pointer}.webwidget-notification img{display:block;margin:0 auto;max-width:100%}.webwidget-notification .webwidget-notification-img{display:inline-block;float:left;width:25%;padding:15px}.webwidget-notification .webwidget-notification-text{display:inline-block;width:75%;padding:15px 15px 15px 0}.webwidget-notification .webwidget-notification-text span{display:block}.webwidget-notification .webwidget-notification-text span.webwidget-notification-title{font-weight:500}#webwidget-clearall{display:block;margin:0 auto;text-align:center;color:#E9E9E9}",document.body.appendChild(e);var t=document.createElement("div");t.setAttribute("id","aimtellNotificationCenter"),t.innerHTML='<div id="webwidget"><img onClick="_aimtellShowNotificationCenter()" id="notification-icon" src="notification_icon.png"><div onClick="_aimtellHideNotificationCenter()" id="notification-icon-close"> X </div><div id="notification-badge"><span id="notification-badge-count">3</span></div><div id="webwidget-content"><div id="webwidget-content-header"> <span>Notifications</span> </div><div id="webwidget-body"></div><div id="webwidget-footer"><a target="_BLANK" href="https://aimtell.com"><span>Powered By Aimtell</span></a></div></div></div>',document.body.appendChild(t),"granted"==_aimtellCheckPermissions()?_aimtellGetWidgetNotifications().then(function(e){_aimtellFillNotifications(e)}):_aimtellShowNotSubscribed()}function _aimtellGetWidgetNotifications(){return new Promise(function(e,t){var i=new XMLHttpRequest;if(i.onreadystatechange=function(){if(4==i.readyState)if(404==i.status);else{JSON.parse(i.responseText);e(i.responseText)}},"undefined"!=typeof _at&&void 0!==_at.subscriber){var a=_at.idSite,n=_at.subscriber;i.open("GET","https://api.aimtell.com/prod/widget/notifications/"+a+"/"+n,!0),i.send(null)}})}function _aimtellFillNotifications(e){if((e=JSON.parse(e)).length<1)return _aimtellShowNoNotifications(),!1;var t=e.length;document.getElementById("webwidget-body").innerHTML="";for(var i=0;i<t;i++)_aimtellAppendNotification(123,e[i].title,e[i].body,e[i].icon,e[i].link);document.getElementById("webwidget-body").innerHTML+="<span onClick='_aimtellDelAllWidgetNotification()' id='webwidget-clearall'> - clear all - </span>",_aimtellCheckNotificationRemaining()}function _aimtellWidgetPermissionGrantedCallback(){_aimtellShowNoNotifications()}function _aimtellPermissionGrantedCallbacks(){"undefined"!=typeof _aimtellPermissionGranted&&_aimtellPermissionGranted(),void 0!==_aimtellWidgetPermissionGrantedCallback&&null!=document.getElementById("webwidget")&&_aimtellWidgetPermissionGrantedCallback(),_aimtellAmplifySubscriberWorkerData()}function _aimtellChromeRun(){navigator.serviceWorker.ready.then(function(e){e.pushManager.getSubscription().then(function(e){if(!e)return _aimtellDebugger("No Subscription Found. Prompting "),void _aimtellSubscribe();_aimtellDebugger("Subscription Found ",subcription),_aimtellSendSubscriptionToServer(e)}).catch(function(e){_aimtellLogError(e.message),_aimtellDebugger("Error during getSubscription()",4)})})}function _aimtellSubscribe(){_aimtellDebugger("Checking if worker is ready."),navigator.serviceWorker.ready.then(function(e){_aimtellDebugger("Worker is ready."),e.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){return _aimtellDebugger("Chrome subscription successful"),_aimtellTrackAttributes({subscription_url:window.location.href}),localStorage.setItem("aimtell_gcm_id",_at.gcm_id),localStorage.setItem("aimtell_subscriber_uid",_at.subscriber),_aimtellPermissionGrantedCallbacks(),_aimtellSendSubscriptionToServer(e)}).catch(function(e){"denied"===Notification.permission?(_aimtellDebugger("Chrome permission denied"),_aimtellTrackData.optin.action=2,_aimtellTrack(_aimtellTrackData,["optin"])):(_aimtellDebugger("Unable to subscribe to push.",4),_aimtellLogError(e.message)),"undefined"!=typeof _aimtellPermissionDenied&&_aimtellPermissionDenied()})})}function _aimtellExtractSubscriptionId(e){var t=e.toString().split("/");return t[t.length-1]}function _aimtellSendSubscriptionToServer(e){var t=e.endpoint,i=_aimtellExtractSubscriptionId(t);"granted"==_aimtellCheckPermissions()&&(_aimtellRegisterWorker(),_aimtellTrackData.optin.action=1,_aimtellTrackData.optin.push_token=i,_aimtellTrackData.optin.endpoint=t,_aimtellTrack(_aimtellTrackData,["attribute","optin","page"]))}function _aimtellAmplifySubscriberWorkerData(){_aimtellSendWorkerMessage({command:"store",subscriber_uid:_at.subscriber,id_site:_at.idSite}).then(function(e){_aimtellDebugger("Postmessage successfully.")})}function _aimtellRegisterWorker(){_aimtellSendWorkerMessage({command:"register",uid:_at.subscriber_uid}).then(function(e){_aimtellDebugger("Service worker registered successfully.")})}function _aimtellSendWorkerMessage(a){return new Promise(function(t,i){var e=new MessageChannel;e.port1.onmessage=function(e){e.data.error?i(e.data.error):t(e.data)},navigator.serviceWorker.controller.postMessage(a,[e.port2])})}function _aimtellLoad(){return new Promise(function(c,t){"serviceWorker"in navigator&&navigator.serviceWorker.register(_at.worker,{scope:"/",updateViaCache:"none"}).catch(function(e){t(e)}),_aimtellGetGCMID().then(function(s){if(!s)throw new Error("[aimtell] - Unable to grab GCM id");_at.gcm_id=s,_aimtellGetSubscriberID().then(function(e){_at.subscriber=e,_aimtellSubscriberID=e;var t=_aimtellGetBrowserInfo(),i=_aimtellGetPageDetails(),a=_aimtellGetReferrer(),n=_aimtellGetSystemInfo(),o=_aimtellGetLanguage(),r=_aimtellGetResolution(),l=_aimtellGetDeviceType();_at.prompt={},(trackData={}).idSite=_at.idSite,trackData.visitor_subscriber_uid=_at.subscriber,trackData.visitor_localtime=new Date,trackData.device_type=l,trackData.device_resolution=r,trackData.browser_name=t.browser,trackData.browser_version=t.version,trackData.device_os=n.os,trackData.device_os_version=n.osVersion,trackData.referrer_url=a.refUrl,trackData.referrer_name=a.refName,trackData.browser_lang=o,trackData.page_title=i.pageTitle,trackData.page_url=i.pageURL,(_aimtellTrackData={}).subscriber_uid=_at.subscriber,_aimtellTrackData.id_site=_at.idSite,_aimtellTrackData.attribute=_aimtellPageLoadAttributes,_aimtellTrackData.attribute.device_type=_aimtellGetDeviceType(),_aimtellTrackData.attribute.browser_name=t.browser,_aimtellTrackData.attribute.device_os=n.os,_aimtellTrackData.attribute.browser_lang=_aimtellGetLanguage(),_aimtellTrackData.page={},_aimtellTrackData.page.url=i.pageURL,_aimtellTrackData.optin={},_aimtellTrackData.optin.action=null,_aimtellTrackData.optin.prompt_id=null,_aimtellTrackData.optin.gcm_id=s,_aimtellTrackData.optin.push_token=null,_aimtellTrackData.event={},_aimtellTrackData.event.category=null,_aimtellTrackData.event.action=null,_aimtellTrackData.event.label=null,_aimtellTrackData.event.value=null,c()})})})}function _aimtellProcessQueue(e){if(e&&0!=e.length){for(var t=0,i=e.length;t<i;t++){var a=e[t][0],n=e[t][1];"alias"==a?_aimtellAlias(n):"event"==a?_aimtellTrackEvent(n.category,n.action,n.label,n.value):"attribute"==a&&_aimtellTrackAttributes(n)}return!0}}function _aimtellForceRefreshSW(e){if("number"!=typeof e)return _aimtellDebugger("[aimtell] - Force refresh value is not a number"),!1;if(0==e&&1!=sessionStorage.getItem("_aimtellSWForcedSession"));else if(1==_aimtellGetCookie("_aimtellSWForced"))return _aimtellDebugger("Subscriber has recently force refreshed push worker"),!1;return _aimtellDebugger("Force updating push worker"),navigator.serviceWorker.getRegistrations().then(function(e){e[0]&&e[0].unregister()}),sessionStorage.setItem("_aimtellSWForcedSession",1),e<1&&(e=1),_aimtellSetCookie("_aimtellSWForced",1,e),!0}!function(){if(void 0!==_aimtellRanScript)return _aimtellLogError("Script loaded twice",1),_aimtellDebugger("[aimtell] Script loaded twice.",4);if(_aimtellRanScript=!0,0==_aimtellSupportsPush())return _aimtellDebugger("Browser does not support push",5),"undefined"!=typeof _aimtellPushSupported&&_aimtellPushSupported(!1);if("undefined"!=typeof _aimtellPushSupported&&_aimtellPushSupported(!0),document.querySelector('link[rel="manifest"]')){_aimtellDebugger("There may already be a manifest file which superscedes ours. See https://aimtell.com/jserror/manifestexists",4)}void 0!==_at.forceRefreshSW?_aimtellRefreshResult=_aimtellForceRefreshSW(_at.forceRefreshSW):"serviceWorker"in navigator&&7487==_at.idSite&&(_aimtellRefreshResult=_aimtellForceRefreshSW(30)),_aimtellLoad().then(function(e){_aimtellInitialize(_at.idSite),_aimtellLoadBeacon(),setTimeout(function(){"undefined"!=typeof _aimtellReady&&_aimtellReady(),"undefined"!=typeof _aimtellShopifyReady&&_aimtellShopifyReady()},1500),void 0!==_at.track&&(_aimtellProcessQueue(_at.track.q),window._at.track=function(){var e=[];return e.push(arguments),_aimtellProcessQueue(e),!0})}).catch(function(e){_aimtellLogError(e,1),_aimtellDebugger(e,5)})}();